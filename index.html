<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUPERSIDERS GLOBALLY</title>
    
    <!-- INLINE CRITICAL CSS - Máxima prioridad, carga instantánea -->
    <style>
        body{margin:0;background:#000;overflow:hidden}
        #loadingScreen{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000;z-index:9999;display:flex;align-items:center;justify-content:center;transform:translate3d(0,0,0);will-change:transform,opacity;backface-visibility:hidden;isolation:isolate;contain:strict}
        #loadingScreen.fade-out{animation:fadeOutScreen 0.5s ease-out forwards}
        .loading-logo{width:310px;height:64px;transform:translate3d(0,0,0);will-change:transform;backface-visibility:hidden;contain:layout style paint}
        .logo-path{fill:#FFF;stroke:none}
        .mask-rect{transform:translate3d(0,100%,0);transform-box:fill-box;transform-origin:50% 100%;will-change:transform;animation:fillUp 0.8s cubic-bezier(.15,.5,.35,.95) forwards;backface-visibility:hidden}
        @keyframes fillUp{0%{transform:translate3d(0,100%,0)}100%{transform:translate3d(0,0,0)}}
        @keyframes fadeOutScreen{to{opacity:0}}
    </style>
    
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- CRÍTICO: NO cargar NADA pesado hasta que termine la animación -->
    <!-- Globe.gl y Three.js se cargarán DESPUÉS del logo -->
    
    <script>
        // SOLUCIÓN DEFINITIVA: Cargar scripts pesados SOLO después de que termine el logo
        // Esto garantiza que la animación CSS corra sin NINGUNA interferencia
        
        (function() {
            // Forzar GPU layer inmediatamente
            window.addEventListener('DOMContentLoaded', function() {
                const loadingScreen = document.getElementById('loadingScreen');
                const logo = document.querySelector('.loading-logo');
                const maskRect = document.querySelector('.mask-rect');
                
                if (loadingScreen) {
                    loadingScreen.style.transform = 'translateZ(0)';
                    loadingScreen.style.willChange = 'transform, opacity';
                }
                if (logo) {
                    logo.style.transform = 'translateZ(0)';
                    logo.style.willChange = 'transform';
                }
                if (maskRect) {
                    maskRect.style.willChange = 'transform';
                }
                
                console.log('GPU layers forced - animation running independently');
            });
            
            // ESPERAR 1 segundo (después del logo) para cargar scripts pesados
            setTimeout(function() {
                console.log('Logo animation complete - now loading heavy scripts...');
                
                // Cargar Globe.gl
                const globeScript = document.createElement('script');
                globeScript.src = '//cdn.jsdelivr.net/npm/globe.gl';
                document.head.appendChild(globeScript);
                
                // Cargar Import Map para Three.js
                const importMap = document.createElement('script');
                importMap.type = 'importmap';
                importMap.textContent = JSON.stringify({
                    "imports": {
                        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
                    }
                });
                document.head.appendChild(importMap);
                
                console.log('Heavy scripts loaded after animation');
            }, 1000);
        })();
    </script>
</head>

<body>
    <!-- Loading screen overlay -->
    <div id="loadingScreen">
        <!-- SVG loader: uses a mask to reveal the fill from bottom->top (water effect). No white outline. -->
        <!-- OPTIMIZADO: shape-rendering y otros hints para performance máxima -->
        <svg class="loading-logo" width="310" height="64" viewBox="0 0 155 32" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Superside loading logo" shape-rendering="geometricPrecision" style="transform: translateZ(0); will-change: transform;">
            <defs>
                <!-- Mask rectangle that will animate upward to reveal the logo fill -->
                <mask id="maskFill">
                    <!-- Start with rect translated down (hidden). The rect is white to reveal the content underneath -->
                    <rect class="mask-rect" x="0" y="0" width="155" height="32" fill="white" />
                </mask>
            </defs>

            <!-- Group all paths and apply the mask (reveal from bottom to top). Paths have no stroke; only fill. -->
            <g class="logo-fill-group" mask="url(#maskFill)">
                <path class="logo-path" d="M22.0876 18.7674C22.0876 16.7854 21.2535 14.8034 19.7398 13.6575L14.3338 9.41476C13.8086 8.98119 13.4997 8.33084 13.4997 7.64953C13.4997 6.62755 14.2411 5.01716 16.0328 5.01716C16.6507 5.01716 17.0831 5.20298 17.6083 5.57461L20.3268 7.6805C21.5624 8.64053 23.1688 9.13604 24.7443 9.13604C28.5749 9.13604 31.3551 6.25592 31.3551 3.18999C31.3551 2.53965 31.2316 1.79639 30.9535 1.17701H26.5051C26.8758 1.73445 26.9994 2.10608 26.9994 2.57061C26.9994 3.90228 26.0109 4.92426 24.5898 4.92426C24.0029 4.92426 23.5704 4.73844 22.0876 3.65453L20.1723 2.22996C18.9675 1.33186 17.4847 0.774414 16.0946 0.774414C13.1908 0.774414 9.26752 3.18999 9.26752 7.52565C9.26752 9.53863 10.1016 11.4587 11.6153 12.6355L16.9905 16.8783C17.5465 17.3118 17.8554 17.9312 17.8554 18.6125C17.8554 19.6655 17.114 21.2759 15.3223 21.2759C14.7045 21.2759 14.272 21.0901 13.7468 20.7184L11.0284 18.6125C9.79268 17.6525 8.18631 17.157 6.61083 17.157C2.78026 17.157 0 20.0371 0 23.103C0 23.7534 0.123567 24.4967 0.401593 25.116H4.85C4.4793 24.5586 4.35574 24.187 4.35574 23.7224C4.35574 22.3908 5.34427 21.3688 6.76529 21.3688C7.35224 21.3688 7.78472 21.5546 9.26752 22.6385L11.1828 24.0631C12.3876 24.9612 13.8704 25.5186 15.2605 25.5186C18.1643 25.5186 22.0876 23.103 22.0876 18.7674Z"/>
                <path class="logo-path" d="M154.552 16.8166C154.583 16.5069 154.614 15.9495 154.614 15.454C154.645 9.97245 151.031 6.31812 145.81 6.31812C143.122 6.31812 140.775 7.27814 139.045 9.01241C137.284 10.7776 136.326 13.2242 136.326 15.8875C136.326 18.5818 137.284 21.0284 139.076 22.8246C140.836 24.5588 143.246 25.5189 145.964 25.5189C150.104 25.5189 153.409 23.2891 154.367 19.7277L154.552 19.2322H150.66L150.567 19.4799C150.073 20.9664 148.25 21.8645 146.15 21.8645C143.061 21.8645 140.929 19.9445 140.558 17.1573H154.46L154.552 16.8166ZM140.713 13.8745C141.331 11.428 143.277 9.91051 145.779 9.91051C148.312 9.91051 150.197 11.4899 150.567 13.8745H140.713Z"/>
                <path class="logo-path" d="M130.456 1.177V8.70246C128.943 7.30886 126.873 6.50367 124.556 6.50367C122.023 6.50367 119.706 7.4637 118.038 9.167C116.339 10.9013 115.412 13.3478 115.412 16.0421C115.412 18.7364 116.339 21.183 118.038 22.9172C119.706 24.6205 122.023 25.5806 124.525 25.5806C126.842 25.5806 128.943 24.7754 130.456 23.3818V25.178H134.565V1.177H130.456ZM128.912 20.192C127.892 21.2449 126.533 21.8023 124.989 21.8023C121.838 21.8023 119.582 19.4177 119.582 16.0421C119.582 12.6975 121.838 10.2819 124.989 10.2819C126.533 10.2819 127.923 10.8703 128.912 11.8923C129.931 12.9452 130.487 14.4317 130.487 16.0421C130.487 17.6835 129.931 19.139 128.912 20.192Z"/>
                <path class="logo-path" d="M111.797 5.2957C112.137 5.2957 112.477 5.23376 112.816 5.07891C113.094 4.95504 113.434 4.73825 113.65 4.52147C113.928 4.27372 114.114 3.96403 114.237 3.71628C114.392 3.34465 114.454 2.97302 114.454 2.63236C114.454 1.17682 113.249 0 111.797 0C110.314 0 109.109 1.17682 109.109 2.66333C109.109 3.00399 109.171 3.37562 109.357 3.65434C109.449 3.96403 109.635 4.27372 109.943 4.55244C110.16 4.76922 110.438 4.95504 110.747 5.07891C111.086 5.23376 111.426 5.2957 111.797 5.2957Z"/>
                <path class="logo-path" d="M113.651 6.99902H109.728V25.1468H113.651V6.99902Z"/>
                <path class="logo-path" d="M101.139 25.5189C105.031 25.5189 107.78 23.1652 107.811 19.6967C107.811 17.0334 106.236 15.3611 102.838 14.432L100.613 13.8436C98.6672 13.3481 97.9567 12.7287 97.9567 11.7996C97.9567 11.5209 98.0185 11.2422 98.0802 11.0564C98.1729 10.7776 98.2965 10.5918 98.5127 10.437C98.9761 9.91052 99.6866 9.69373 100.582 9.69373C102.374 9.69373 103.703 10.5609 104.135 11.9854L104.228 12.2332H107.842L107.749 11.7687C107.132 8.64078 104.166 6.31812 100.521 6.31812C98.729 6.31812 97.0608 6.87556 95.9178 7.8356C94.713 8.85757 94.1261 10.2821 94.1261 11.9235C94.1261 13.3171 94.5586 14.401 95.3618 15.2682C96.2267 16.1663 97.4624 16.7856 99.0997 17.2502L101.262 17.8695C103.177 18.396 103.919 19.0154 103.919 20.0374C103.919 21.2761 102.807 22.1433 100.891 22.1433C98.8834 22.1433 97.4006 21.2142 97.0917 19.6967L96.999 19.418H93.6318V19.8206C93.8172 21.4929 94.6822 22.9485 96.0723 23.9704C97.4315 24.9614 99.2541 25.5189 101.139 25.5189Z"/>
                <path class="logo-path" d="M82.9131 25.1782H86.9908V14.9894C86.9908 11.9854 88.8134 10.1273 91.6863 10.0963C92.2424 10.0963 92.7058 10.1583 93.2309 10.2821L93.6943 10.468V6.59684L93.4163 6.50393C92.8293 6.38005 92.2424 6.31812 91.7172 6.31812C89.7711 6.31812 88.1647 7.21622 86.9908 8.91951V6.75168H82.9131V25.1782Z"/>
                <path class="logo-path" d="M80.9981 16.8166C81.029 16.5069 81.0599 15.9495 81.0599 15.423C81.029 9.97245 77.4764 6.31812 72.2866 6.31812C69.6299 6.31812 67.2821 7.27814 65.5831 9.01241C63.8532 10.7776 62.8955 13.2242 62.8955 15.8875C62.8955 18.5818 63.884 21.0284 65.6449 22.7936C67.3748 24.5588 69.7535 25.5189 72.472 25.5189C76.5806 25.5189 79.8242 23.2891 80.7818 19.7277L80.9672 19.2322H77.1057L77.013 19.4799C76.5188 20.9664 74.727 21.8645 72.6264 21.8645C69.5681 21.8645 67.4675 19.9445 67.1277 17.1573H80.9054L80.9981 16.8166ZM67.2512 13.8745C67.8691 11.428 69.7844 9.91051 72.2557 9.91051C74.7579 9.91051 76.6114 11.4899 76.9821 13.8745H67.2512Z"/>
                <path class="logo-path" d="M58.757 8.98169C57.1198 7.2784 54.8338 6.31836 52.4551 6.31836C50.0147 6.31836 47.914 7.34034 46.4312 9.22944V6.72096H42.3535V31.8678H46.4312V22.7319C47.9449 24.5591 50.0147 25.5811 52.4551 25.5811C54.8338 25.5811 57.1198 24.621 58.757 22.9177C60.4252 21.1525 61.3519 18.675 61.3519 15.9497C61.3519 13.2244 60.4252 10.7469 58.757 8.98169ZM55.6987 20.1925C54.7102 21.2144 53.3819 21.7719 51.8682 21.7719C48.7172 21.7719 46.4312 19.3563 46.4312 15.9497C46.4312 12.5741 48.7172 10.1275 51.8373 10.1275C53.3819 10.1275 54.7102 10.716 55.6987 11.7379C56.7182 12.8218 57.2742 14.3084 57.2742 15.9497C57.2742 17.622 56.7182 19.1085 55.6987 20.1925Z"/>
                <path class="logo-path" d="M30.8916 25.5185C32.8996 25.5185 34.5677 24.8062 35.7416 23.5055V25.0849H39.8811V6.99902H35.7416V17.2807C35.7416 20.006 34.2279 21.7093 31.7875 21.7093C30.6754 21.7093 29.7177 21.3686 29.0381 20.7183C28.2967 20.006 27.9569 18.984 27.9569 17.7143V10.9321H23.8174V18.1788C23.8174 20.3467 24.497 22.2048 25.8253 23.5365C27.0919 24.8062 28.8527 25.5185 30.8916 25.5185Z"/>
            </g>
        </svg>
    </div>
    
    <!-- Globe visualization container -->
    <div id="globeViz"></div>
    
    <!-- Info Panel -->
    <div class="info-panel">
        <h2>SUPERSIDERS GLOBALLY</h2>
        <p>Total countries: <span id="country-count">0</span></p>
        <p>Supersiders selected: <span id="total-count">0</span></p>
        <p><em>Click on points to see details</em></p>
    </div>
    
    <!-- Category Panel -->
    <div class="category-panel">
        <h3>Explore Questions</h3>
        <div class="category-list" id="categoryList">
            <!-- Categories will be populated here -->
        </div>
    </div>
    
    <!-- Country Panel -->
    <div class="country-panel collapsed" id="countryPanel">
        <h3 onclick="toggleCountryPanel()">
            Countries 
            <span class="collapse-arrow" id="collapseArrow">▼</span>
        </h3>
        <div class="country-content" id="countryContent">
            <div class="country-controls">
                <button onclick="selectAllCountries()">Select All</button>
                <button onclick="deselectAllCountries()">Deselect All</button>
            </div>
            <div class="country-list" id="countryList">
                <!-- Countries will be populated here -->
            </div>
        </div>
    </div>

    <!-- Country Info Overlay -->
    <div class="country-info-overlay" id="countryInfoOverlay">
        <button class="close-info" onclick="hideCountryInfo()">×</button>
        <div class="country-info-title" id="countryInfoTitle">COUNTRY NAME</div>
        <div class="country-info-count" id="countryInfoCount">000</div>
        <div class="supersiders-text">SUPERSIDERS</div>
    </div>

    <!-- Custom Tooltip -->
    <div class="custom-tooltip loading-disabled" id="customTooltip">
        <div class="tooltip-name" id="tooltipName">COUNTRY NAME</div>
        <div class="tooltip-count" id="tooltipCount">000 SUPERSIDERS</div>
        <div class="tooltip-coords" id="tooltipCoords">Lat: 0.00°, Lng: 0.00°</div>
    </div>

    <!-- Main Application Script - CARGADO DESPUÉS DEL LOGO -->
    <script>
        // Cargar el script principal SOLO después de que Globe.gl esté disponible
        setTimeout(function() {
            // Esperar a que Globe.gl esté disponible
            const checkGlobe = setInterval(function() {
                if (typeof Globe !== 'undefined') {
                    clearInterval(checkGlobe);
                    console.log('Globe.gl ready - loading main app...');
                    
                    const mainScript = document.createElement('script');
                    mainScript.type = 'module';
                    mainScript.src = 'js/main.js';
                    document.body.appendChild(mainScript);
                }
            }, 100);
        }, 1100);
    </script>
</body>
</html>
